## 概要

- 遺伝的アルゴリズムを使って、スケジューリング最適化する。
- コンソールと、output.csv、output.tsvに結果を出力する。
    - output.tsvの結果をExcelに貼り付ければExcelで共有可能。

## 制約条件

- 日ごとの定員を超えないようにする。
- 組み合わせでの出勤が必要な人が、正しく組み合わせされている。
- マネージャがどの日も1人はいるように設定される。
- 出勤できない日は休みにする。
- 出勤が必要な日は出勤にする。
- 合計の工数が予定工数に近くなるようにする。


## こちらの記事を大いに参考にした

https://qiita.com/shouta-dev/items/1970c2746c3c30f6b39e


## パラメータの変更方法

- パラメータはsetting.tomlで設定する。

1. [calendar]の設定
- シフトを組む年月をyearとmonthに設定する。
- デフォルトでは土日祝日がシフト対象外になるが、平日扱いしたい日があればspecial_weekdaysに設定する。
- 平日でも祝日扱いしたい日があれば、special_holidaysに設定する。

2. [optimize]の設定
- 遺伝的アルゴリズムを設定する。
- 詳細は割愛する。(遺伝的アルゴリズムの解説サイトを読む)

3. [capacity]の設定
- 各日の最大人数と最少人数を設定する。

4. [evaluate]の設定
- 個体を評価する関数を設定する。
- methodに記載するのは、shift.pyの__init__に記載しているエイリアス。
    - エイリアス名を変更すれば、tomlの記載も変更できる。
- weightはその関数の評価結果をどの程度重視すべきかの数値。
    - 小さい方が好ましい値は負を設定する。
- descriptionは自由に設定して良い。
    - 実行後にコンソールに表示されるのみ。

5. [member]の設定
- シフトを組むメンバーを設定する。
- noは自由な値で良いが、被らない値を設定する。
- nameは自由は値で良い。実行後にコンソールに表示されるのみ。
- is_managerは、どの日も1人は必要な人にtrue、そうではない人にfalseを設定。
- man_hour_rateは工数を0-1で設定。
- impossible_datesは、出勤できない日を設定。
    - 休日を設定することは考慮しておらず、エラーになる。
- required_datesは、出勤が必要な日を設定。
    - 休日を設定することは考慮しておらず、エラーになる。
- related_membersは、一緒に出社が必要な人のnoを設定。


## 良い結果が出ない場合の改善余地 (なんとか実装できたレベルでの考え)

- 実装は変えない改善
    - setting.tomlに設定している遺伝的アルゴリズムのパラメータをうまく変える。
    - setting.tomlに設定している評価関数の重みをうまく変える。
    - 制約条件をもっと緩くする。
- 実装を変える改善
    - 選択関数としてトーナメント方式を採用しているが、違う方式を採用する。
    - 偶数番目と奇数番目の個体の交叉を実装しているが、もっとうまく交叉する。
    - 異なる評価関数を実装する。
    - 各個体の初期値をランダム関数ではなく、筋の良い初期値を設定する。

## コンテナ起動

```
$ docker compose up -d
```

## コンテナへの入り方

```
$ docker exec -it deap_optimize bash
```

## 実行方法

```
$ cd /usr/local/deap_optimize

デフォルト設定ファイル(setting.toml)を使う場合
$ python3 main.py

異なるファイル名の設定ファイルを使う場合
$ python3 main.py --setting setting_2.toml
```
